<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
</head>
<style>
@import url('https://fonts.googleapis.com/css?lang=en&family=Product+Sans|Roboto:400,700');

body {
    margin:0px;
    background: #e0e0e0;
}

.card {
    overflow:hidden;
    padding:0px;
background-color: white;
border-radius: 24px;
box-shadow: 0px 8px 12px rgba(0,0,0,0.3);
}

.card .content {
    padding:16px;
}

.pillButton {
font-family: "Product sans";
font-size: 36px;
padding: 16px;
border: 0px;
outline: 0px;
cursor: pointer;
border-radius:512px;
color:white;
background:#98CD14;
}
.pillButton:hover {
background-color:#C9F167;
}
.pillButton:active {
    background-color: #77A407;
}
h1 {
    margin: 0px;
font-family: "Product sans";
}
#skinImg {
    width:100%;
    object-fit: cover;
    }
#spinButton {
    width:100%;
}
#caseSelect {
    font-family: "Product Sans";
    margin-bottom: 8px;
    border-radius: 500px;
    padding: 8px;
    font-size: 18px;
    width:100%;
    background: #e0e0e0;
    border: 0px;
    outline:0px;
}
#spinResult {
    font-weight: 900;
}
</style>
</head>
<body>

<div class="card" style="margin:8px;">
    <div class="content">
<h1 id="moneySpentCounter" style="margin-bottom:8px;">0kr</h1>
<select name="case" id="caseSelect">
</select>
<button class="pillButton" id="spinButton" ontouchstart="">OPEN CASE</button>
</div>
</div>

<div class="card" style="margin:8px;" id="resultCard">
    
<div class="content">
<h1 id="spinResult">Resultat</h1>
</div>
<img id="skinImg">
</div>

</body>
<script>
var rarities =  {
"blue":{
    "name": "Mil-Spec",
    "color": "#104FE0",
    "lightColor": "#87ABFF",
    "dropChance": 79.92
},
"purple":{
    "name": "Restricted",
    "color": "#750CE1",
    "lightColor": "#C184FF",
    "dropChance": 15.98
},
"pink":{
    "name": "Classified",
    "color": "#E100CE",
    "lightColor": "#FF8CF5",
    "dropChance": 3.2
},
"red":{
    "name": "Covert",
    "color": "#FD000D",
    "lightColor": "#FF878D",
    "dropChance": 0.64
},
"yellow":{
    "name": "Special Item",
    "color": "#FFB400",
    "lightColor": "#FFD46B",
    "dropChance": 0.26
}
};

var cases;
var casesListURL = "";

var moneySpent = 0;

var currentCaseIndex = 0;

$(function() {

    $.getJSON(casesListURL, function(data) {
       cases = data;
    });

    for(var i = 0; i < cases.length; i++) {
        var newOption = $("<option></option>").attr("name", cases[i].name).html(cases[i].name);
        $("#caseSelect").append(newOption);
    }
    
    if(getCookie("selectedCaseIndex") == "undefined") {
 currentCaseIndex = 0;
 document.cookie = "selectedCaseIndex= " + currentCaseIndex;
    } else {
        currentCaseIndex = getCookie("selectedCaseIndex");
    }
    $("#caseSelect").prop("selectedIndex", currentCaseIndex);

    $("#caseSelect").change(function() {
currentCaseIndex = this.selectedIndex;
document.cookie = "selectedCaseIndex= " + currentCaseIndex;
    });


$("#spinButton").click(function() {
    moneySpent += 21;
    $("#moneySpentCounter").html(moneySpent + "kr");
    spin();
})
});

function getCookie(name) {
  var value = "; " + document.cookie;
  var parts = value.split("; " + name + "=");
  if (parts.length == 2) return parts.pop().split(";").shift();
}

function spin() {
    var randomNum = Math.random() * 100;
    var droppedRarity = calculateSpec(randomNum);
    var sorted;
    
    switch(droppedRarity) {
        case 0:
        sorted = cases[currentCaseIndex].skins.filter(function(cs) {
             return cs.rarity == rarities.blue.name;
          });
          console.log(sorted);
        $("#spinResult").css("color", "#fff");

        $("#skinImg").css("filter", "drop-shadow(0px 0px 30px " + "#fff" + ")");
        $("#resultCard").css("background-image", "linear-gradient(to bottom right, " + rarities.blue.lightColor + ", " + rarities.blue.color);

        break;
        case 1:
        sorted = cases[currentCaseIndex].skins.filter(function(cs) {
             return cs.rarity == rarities.purple.name;
          });
          console.log(sorted);
        
          $("#spinResult").css("color", "#fff");

$("#skinImg").css("filter", "drop-shadow(0px 0px 30px " + "#fff" + ")");
$("#resultCard").css("background-image", "linear-gradient(to bottom right, " + rarities.purple.lightColor + ", " + rarities.purple.color);
        break;
        case 2:
        sorted = cases[currentCaseIndex].skins.filter(function(cs) {
             return cs.rarity == rarities.pink.name;
          });
          console.log(sorted);
          $("#spinResult").css("color", "#fff");

$("#skinImg").css("filter", "drop-shadow(0px 0px 30px " + "#fff" + ")");
$("#resultCard").css("background-image", "linear-gradient(to bottom right, " + rarities.pink.lightColor + ", " + rarities.pink.color);
        break;
        case 3:
        sorted = cases[currentCaseIndex].skins.filter(function(cs) {
             return cs.rarity == rarities.red.name;
          });
          console.log(sorted);
          alert("You got a covert!");
          $("#spinResult").css("color", "#fff");

$("#skinImg").css("filter", "drop-shadow(0px 0px 30px " + "#fff" + ")");
$("#resultCard").css("background-image", "linear-gradient(to bottom right, " + rarities.red.lightColor + ", " + rarities.red.color);
        break;
        case 4:
        sorted = cases[currentCaseIndex].skins.filter(function(cs) {
             return cs.rarity == rarities.yellow.name;
          });
          console.log(sorted);
          $("#spinResult").css("color", "#fff");

$("#skinImg").css("filter", "drop-shadow(0px 0px 30px " + "#fff" + ")");
$("#resultCard").css("background-image", "linear-gradient(to bottom right, " + rarities.yellow.lightColor + ", " + rarities.yellow.color);
        alert("You got a special item!");

        break;
    }
var randomSkinOfRarity = sorted[Math.floor(Math.random()*sorted.length)];

  $("#spinResult").html(randomSkinOfRarity.weapon + " | " + randomSkinOfRarity.name);
  $("#skinImg").attr("src", randomSkinOfRarity.imageUrl);
}

function calculateSpec(random) {
    if((random -= rarities.blue.dropChance) < 0) {
        return 0;
    }
    if((random -= rarities.purple.dropChance) < 0) {
        return 1;
    }
    if((random -= rarities.pink.dropChance) < 0) {
        return 2;
    }
    if((random -= rarities.red.dropChance) < 0) {
        return 3;
    }
    if((random -= rarities.yellow.dropChance) < 0) {
        return 4;
    }
}
</script>
</html>
